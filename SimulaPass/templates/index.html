<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<title>Simulação</title>
	<script src="/static/js/jquery1.6.1.js" type="text/javascript"></script>
	<script src="/static/js/jquery-ui-1.8.14.custom/js/jquery-ui-1.8.14.custom.min.js" type="text/javascript"></script>

    <link href="/static/js/jquery-ui-1.8.14.custom/css/ui-lightness/jquery-ui-1.8.14.custom.css" rel="stylesheet" type="text/css">
	<link href="/static/css/base.css" rel="stylesheet" type="text/css">
	
    <script>
        var global = {}
            
        function limpa_simulacao(){
            $('span').remove();
        }
        
        function cria_passageiros(qtd, obj){
           for(i=0;i<qtd;i++){
               $('.'+obj.passageiros[i].tipo).append("<span class='pessoa' id="+i+"></span>")
           }
        }
        
        function movimenta_passageiros(qtd, obj){
            for(i=0;i<  qtd;i++){
                if(obj.passageiros[i].transporte){
                    $('#'+i).animate({
                        left:$('.'+obj.passageiros[i].transporte).offset().left,
                        top:$('.'+obj.passageiros[i].transporte).offset().top,
                        opacity:"0%"
                    },2000);
                }else{
                    $('#'+i).css('background-color','red');
                }
                
            }
        }
        
        $(document).ready(function(){
            $('#simular').click(function(){
                limpa_simulacao();
                var num_pessoas = $('#num_pessoas').val();
                
                $.getJSON('/ajax/'+num_pessoas+'/', function(data){
                    //console.log(data);
                    global = data;
                    var qtd_pessoas = data.passageiros.length;

                    cria_passageiros(qtd_pessoas,data);
                    movimenta_passageiros(qtd_pessoas,data);
                    

                    //console.log(data.passageiros.length())
                });
            });
        });//document.ready
    </script>
</head>

<body>
    <fieldset>
        <legend>Numero de Pessoas:</legend>
        <input type="text" name='num_pessoas' id='num_pessoas'>    
         <input type="button" value="simular" id='simular'>
    </fieldset>
   
    <fieldset class='ambiente'>
        <legend>Ambiente</legend>
        {% for passageiro in passageiros %}
            <fieldset class='passageiro {{passageiro.nome}}' id='{{passageiro.nome}}'>
                <legend>{{passageiro.nome}}</legend>
            </fieldset>
        {%endfor%}

        {% for transporte in transportes %}
            <fieldset class='transporte {{transporte.nome}}' id='{{transporte.nome}}'><legend>{{transporte.nome}}</legend></fieldset>
        {%endfor%}
    </fieldset>
    
</body>

</html>
